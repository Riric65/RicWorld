<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stats Requêtes</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&display=swap');

:root {
    --primary: #00f260;
    --secondary: #0575e6;
    --bg-dark: #0f0c29;
    --glass: rgba(255,255,255,0.05);
    --border: rgba(255,255,255,0.1);
}

body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: var(--bg-dark);
    color: white;
}

section {
    padding: 100px 10%;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 40px;
}

h1 {
    font-size: 3em;
    background: linear-gradient(to right, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.chart-container {
    width: 360px;
    height: 360px;
    max-width: 90vw;
    max-height: 90vw;
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 20px;
    box-sizing: border-box;
}
</style>
</head>

<body>

<section>
    <h1>Statistiques des Requêtes</h1>

    <div class="chart-container">
        <canvas id="requestsChart"></canvas>
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const ctx = document.getElementById('requestsChart').getContext('2d');

const chart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: ['Humains', 'Bots amicaux', 'Scanners', 'Exploits'],
        datasets: [{
            data: [0, 0, 0, 0],
            backgroundColor: [
                'rgba(0,242,96,0.85)',
                'rgba(5,117,230,0.85)',
                'rgba(255,165,0,0.85)',
                'rgba(255,0,90,0.85)'
            ],
            borderColor: [
                'rgba(0,242,96,1)',
                'rgba(5,117,230,1)',
                'rgba(255,165,0,1)',
                'rgba(255,0,90,1)'
            ],
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '65%',
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    color: 'white',
                    font: { size: 14 }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(0,0,0,0.8)',
                titleColor: '#00f260',
                bodyColor: 'white'
            }
        }
    }
});

function updateStats() {
    fetch('/stats')
        .then(r => r.json())
        .then(data => {
            chart.data.datasets[0].data = [data.humans, data.cleanBots, data.scanners, data.exploits];
            chart.update();
        })
        .catch(e => console.error('Stats error', e));
}

updateStats();
setInterval(updateStats, 10000);
</script>

</body>
</html>
